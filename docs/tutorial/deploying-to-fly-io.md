---
sidebar_position: 5
---

# Deploying to Fly.io & Vercel

*This tutorial describes how to set up a Canvas application with a separate frontend and backend. Also consider cloning the Canvas examples ([1](https://github.com/canvasxyz/canvas/tree/main/examples/chat-next), [2](https://github.com/canvasxyz/canvas/tree/main/examples/chat-webpack)) for setups that serve both from one container.*

## Deploying a Canvas contract to Fly.io

Fly.io is an application hosting platform which uses micro-VMs running
on a global network.Unlike most other application hosting platforms,
Fly provides easy access to disk storage volumes. This lets us run
Canvas apps that use SQLite databases on Fly, just like we run them in
development. Conveniently, Fly also has a generous [free
tier](https://fly.io/docs/about/pricing/).

### Getting started

First make sure you have [flyctl](https://fly.io/docs/getting-started/installing-flyctl/) installed, and that you are logged in. Follow the instructions in the link, or on Mac, just run:

```
brew install flyctl
flyctl auth login   # `flyctl auth signup` for new users
```

### Setting up your application

You'll need a few files to deploy a Canvas backend node:

- [A Dockerfile](https://github.com/canvasxyz/canvas/blob/main/examples/chat-webpack/Dockerfile)
- [A fly.toml](https://github.com/canvasxyz/canvas/blob/main/examples/chat-webpack/fly.toml)
- [Your spec](https://github.com/canvasxyz/canvas/blob/main/examples/chat-webpack/spec.canvas.js), which we'll assume is `spec.canvas.js`

First, create a new directory, and download the example files from the links above. (If your spec is named something else, edit the Dockerfile accordingly.)

Now, run `flyctl launch` to set up a Fly configuration file for your application.

Fly should autodetect your Dockerfile, and prompt you for a name and region. When it asks you if you need a Postgres database, select **no**, and when it asks you to deploy, also select **no**.

```
% flyctl launch

Creating app in /example
Scanning source code
Detected a Dockerfile
? App Name (leave blank to use an auto-generated name): canvas-example-chat
Automatically selected personal organization: [Your Name]
? Select region: [Your Region]
Created app canvas-example-chat in organization personal
Wrote config file fly.toml
? Would you like to setup a Postgresql database now? No
? Would you like to deploy now? No
```

At this point, you should have an autogenerated fly.toml in your directory.

### Adding a storage volume

To persist data, you'll need to set up a storage volume called `canvas_example_chat_data`, which you can do with:

```
fly volumes create canvas_example_chat_data
```

### Adding a blockchain RPC

If your app reads from a smart contract, you'll need to provide an RPC endpoint for the chain you're connecting to. For Ethereum and L2 users, sign up for [Infura](https://infura.io/)'s [free tier](https://infura.io/pricing), create a project, and add it to the configuration:

```
fly secrets set ETH_CHAIN_ID=1 ETH_CHAIN_RPC=https://mainnet.infura.io/v3/[API_KEY]
```

**If you skip this step, you should modify the Dockerfile to add `--unchecked` to the canvas run command.** Otherwise, your app won't be able to start in production. Replace the CMD line in Dockerfile:

```
CMD ["canvas", "run", "--unchecked", "./spec.canvas.js", "--datadir", "/data"]
```

### Deploying

Now, you're ready to push your application!

```
fly deploy
```

Once the deployment is complete, you should have a running application at a subdomain of .fly.dev. Use `fly info` to see where it's hosted:

```
% fly info
App
  Name     = fragrant-star-4920
  Owner    = personal
  Version  = 0
  Status   = running
  Hostname = fragrant-star-4920.fly.dev

Services
PROTOCOL PORTS
TCP      80 => 8000 [HTTP]
         443 => 8000 [TLS, HTTP]

IP Adresses
TYPE ADDRESS             REGION CREATED AT
v4   37.16.26.48                1m52s ago
v6   2a09:8280:1::3:6029        1m51s ago
```

If you go to the new app's hostname (e.g. fragrant-star-4920.fly.dev), you should get an HTTP response that shows the node is running:

```ts
{"name":"QmZ3Wsp92rS1c31PJ6g1qVCQKv4jxA51qqg4TaRefBQ2vM"}
```

### Troubleshooting

If you have any problems, here are a few troubleshooting tips:

- Try cloning the directory at https://github.com/canvasxyz/canvas/tree/main/examples/chat-webpack and deploying it, following README.md.
- Try building and running the Dockerfile locally. First, use `docker build .` to run the build process, which will create a container with your spec. Then, try `docker run -p8000:8000 [hash]`, passing it the image ID that was generated by the build stage. This should give you a working server that can be accessed from your browser at [localhost:8000](http://localhost:8000).

## Deploying a Canvas frontend to Vercel

Since the frontend we built is a create-react-app application, it should be easy to deploy on the platform of your choice.

First, in the <Canvas\> element in `src/index.js`, switch out localhost:8000 for the URL of a Canvas node. You can use the URL of your deployment on Fly.io above.

Then run `vercel` from the application's root directory to build and deploy to the Vercel network. For production, use `vercel --prod` instead.

```
% npm install -g vercel
% vercel

? Set up and deploy ‚Äú~/canvas-demo‚Äù? [Y/n] y
? Which scope do you want to deploy to? My Team
? Link to existing project? [y/N] n
? What‚Äôs your project‚Äôs name? (canvas-demo)
üîó Linked to yourname/canvas-demo (created .vercel and added it to .gitignore)
```
