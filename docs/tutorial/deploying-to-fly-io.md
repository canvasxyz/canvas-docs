---
sidebar_position: 4
---

# Deploying to Fly.io

Fly.io is an application hosting platform which uses micro-virtual machines, running on a global network, much like a CDN.

Unlike most other hosting platforms, Fly.io apps have access to block storage volumes (disk storage), while other hosts force you to store data on a managed database like Postgres. This means we can deploy Canvas apps that use SQLite databases, just like we do in development.

Fly has a liberal free tier, enough to run both a client and a server. It also supports more modern technologies, and it's developed by a top team.


### Getting started

First make sure you have [flyctl](https://fly.io/docs/getting-started/installing-flyctl/) installed, and that you are logged in.

Follow the instructions linked above, or on Mac, you can also use:

```
brew install flyctl
flyctl auth login    # `flyctl auth signup` if you've never used Fly
```

### Setting up your server

You'll need a few files to deploy a Canvas backend node:

- [A Dockerfile](https://github.com/canvasxyz/canvas/blob/main/packages/example-chat-server/Dockerfile)
- [A fly.toml](https://github.com/canvasxyz/canvas/blob/main/packages/example-chat-server/fly.toml)
- Your spec, which we'll assume is `spec.canvas.js`

Create a directory and download the example Dockerfile and fly.toml from the links above. If your spec is named something else, modify the Dockerfile accordingly.

Run `flyctl launch` to set up a Fly configuration file for your application. Fly should autodetect your Dockerfile, and prompt you for a name and region. When it asks you if you need a Postgres database, select **no**, and when it asks you to deploy, also select **no**.

```
% flyctl launch

Creating app in /canvas/packages/example-chat
Scanning source code
Detected a Dockerfile
? App Name (leave blank to use an auto-generated name): canvas-example-chat
Automatically selected personal organization: [Your Name]
? Select region: [Your Region]
Created app canvas-example-chat in organization personal
Wrote config file fly.toml
? Would you like to setup a Postgresql database now? No
? Would you like to deploy now? No
```

At this point, you should have an autogenerated fly.toml in your directory.

To persist data, you'll need to set up a storage volume called `canvas_example_chat_data`, which you can do with:

```
fly volumes create canvas_example_chat_data
```

If your app reads from a smart contract, you'll need to provide an RPC endpoint for the chain you're connecting to. For Ethereum and L2 users, you can sign up for [Infura](https://infura.io/)'s [free tier](https://infura.io/pricing), create a project, and add it to the configuration:

```
fly secrets set ETH_CHAIN_ID=1 ETH_CHAIN_RPC=https://mainnet.infura.io/v3/[INFURA_ACCESS_TOKEN]
```

Now, you're ready to push your application to production!

```
fly deploy
```

Once the deployment is complete, you should have a running application at a subdomain of .fly.dev. Continue on to the client tutorial below to setup a frontend and interact with the application.

If you have any trouble, here are a few quick troubleshooting tips:

- Try cloning the directory at https://github.com/canvasxyz/canvas/tree/main/packages/example-chat-server and deploying it, following README.md.
- Try building and running the Dockerfile locally. First, use `docker build .` to run the build process, which will create a container with your spec. Then, try `docker run -p8080:8080 [hash]`, passing it the image ID that was generated by the build stage. This should give you a working server that can be accessed from your browser at [localhost:8080](http://localhost:8080).
