<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-canvas/packages/cli/README">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Canvas CLI | Canvas</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.canvas.xyz/docs/canvas/packages/cli"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Canvas CLI | Canvas"><meta data-rh="true" name="description" content="Canvas provides a command line interface for running Canvas applications. This is the primary way to run apps and join the peer-to-peer network."><meta data-rh="true" property="og:description" content="Canvas provides a command line interface for running Canvas applications. This is the primary way to run apps and join the peer-to-peer network."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.canvas.xyz/docs/canvas/packages/cli"><link data-rh="true" rel="alternate" href="https://docs.canvas.xyz/docs/canvas/packages/cli" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.canvas.xyz/docs/canvas/packages/cli" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.dc030687.css">
<link rel="preload" href="/assets/js/runtime~main.7e87f4e2.js" as="script">
<link rel="preload" href="/assets/js/main.42f05762.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_inv.png" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Canvas</b></a><a href="#" class="navbar__item navbar__link navbar-badge">v0.4</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/canvasxyz/canvas" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://twitter.com/canvas_xyz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://canvas.xyz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.png" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_inv.png" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"><b>Canvas</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Canvas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/roadmap">Roadmap and changelog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tutorial/writing-a-canvas-contract">Tutorial</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/api">Contract Language</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/formats">Basic Data Formats</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/custom">Custom Data Formats</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/canvas/packages/hooks">React Hooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/canvas/packages/cli">Command Line</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Other Packages</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/canvas/packages/core">@canvas-js/core</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/canvas/packages/interfaces">@canvas-js/interfaces</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Command Line</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Canvas CLI</h1><p>Canvas provides a command line interface for running Canvas applications. This is the primary way to run apps and join the peer-to-peer network.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="installation">Installation<a href="#installation" class="hash-link" aria-label="Direct link to Installation" title="Direct link to Installation">​</a></h2><p>To install the CLI, run:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">npm install -g @canvas-js/cli</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="usage">Usage<a href="#usage" class="hash-link" aria-label="Direct link to Usage" title="Direct link to Usage">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">canvas &lt;command&gt;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Commands:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  canvas init &lt;filename&gt;  Create an example contract</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  canvas info &lt;spec&gt;      Show the models, views, and actions for a spec</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  canvas run &lt;spec&gt;       Run an app, by path or IPFS hash</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  canvas export &lt;spec&gt;    Export actions and sessions as JSON to stdout</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  canvas import &lt;spec&gt;    Import actions and sessions from stdin</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  canvas list             List all specs in the data directory</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  canvas install &lt;spec&gt;   Install an app in the canvas home directory</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --version  Show version number                                       [boolean]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --help     Show help                                                 [boolean]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Canvas CLI stores contracts and their data in the <code>$CANVAS_HOME</code> directory, which defaults to <code>~/.canvas</code> if not set.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="running-an-application">Running an application<a href="#running-an-application" class="hash-link" aria-label="Direct link to Running an application" title="Direct link to Running an application">​</a></h2><p>The main command is <code>canvas run &lt;app&gt;</code>. This will start a libp2p node, SQLite database, QuickJS VM for processing actions, and an HTTP API server. Use the <code>--help</code> flag to learn more.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="installing-contracts">Installing contracts<a href="#installing-contracts" class="hash-link" aria-label="Direct link to Installing contracts" title="Direct link to Installing contracts">​</a></h3><p>The <code>app</code> positional argument can either be a filename or the bare IPFS CIDv0 of a contract. By default, passing a filename will start the app in development mode, which runs entirely offline and in-memory. To persist data in the <code>$CANVAS_HOME</code> directory and join the libp2p mesh, you can install the app with <code>canvas install &lt;filename&gt;</code> and then run it by its CID.</p><p><code>canvas run &lt;filename&gt; --install</code> is a shortcut that does both of these in one step, initializing a new app directory inside <code>$CANVAS_HOME</code> if necessary.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="providing-chain-rpcs-and-multi-chain-support">Providing chain RPCs and multi-chain support<a href="#providing-chain-rpcs-and-multi-chain-support" class="hash-link" aria-label="Direct link to Providing chain RPCs and multi-chain support" title="Direct link to Providing chain RPCs and multi-chain support">​</a></h3><p>Canvas applications declare which chains they support using the <code>export const chains: string[]</code> contract export, which is an array of <a href="https://github.com/ChainAgnostic/CAIPs/blob/master/CAIPs/caip-2.md" target="_blank" rel="noopener noreferrer">CAIP-2 chain identifiers</a>. For now, the CLI <strong>only supports Ethereum chains</strong> whose CAIP-2 identifiers are of the form <code>eip155:${chainId}</code>. <code>eip155:1</code> is mainnet, <code>eip155:100</code> is Gnosis, and so on.</p><p>When you run an app from the CLI, you have to provide an RPC URL for each of these chains declared by the contract so that the runtime can validate the blockhashes in messages and call the view functions of any external on-chain contracts. This is done with the <code>--chain=${url}</code> option.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">$ canvas run example.canvas.js --install --chain eip155:1=https://mainnet.infura.io/v3/...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If your app doesn&#x27;t use on-chain contracts and you don&#x27;t want to require blockhashes in messages, you can use the <code>--unchecked</code> flag to disable these checks and omit the RPC URL. However, you still have to pass the CAIP-2 identifiers for all of the chains in the contract.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">$ canvas run example.canvas.js --install --chain eip155:1 --unchecked</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In either case, you can pass multiple <code>--chain</code> options, and will have to if the contract declares more than one chain.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="joining-the-libp2p-mesh">Joining the libp2p mesh<a href="#joining-the-libp2p-mesh" class="hash-link" aria-label="Direct link to Joining the libp2p mesh" title="Direct link to Joining the libp2p mesh">​</a></h3><p>By default, <code>canvas run</code> assumes that you are behind a NAT layer without a public IP address. It will still automatically join the libp2p mesh using the <strong>public Canvas relay servers</strong> that the developers run. Relayed connections are secure, but aren&#x27;t real p2p and shouldn&#x27;t be used in production.</p><p>To join the libp2p mesh directly, you have to provide the CLI with an internal port bind a WebSocket server using the <code>--listen</code> option, and a public external address using the <code>--announce</code> option. Both of these must be formatted as <a href="https://github.com/multiformats/multiaddr" target="_blank" rel="noopener noreferrer">multiaddrs</a>, the generic composable network address format used by libp2p.</p><p>For example, this tells the CLI to listen on port 4444 and advertise <code>wss://foobar.com:8000</code> as the public address:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">$ canvas run example.canvas.js ... --listen /ip4/0.0.0.0/tcp/4444/ws --announce /dns4/foobar.com/tcp/443/wss</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This assumes that you&#x27;ve configured your server to handle incoming secure websocket connections over TLS on port <code>443</code>, do TLS termination, and proxy the connection to your internal port <code>4444</code>.</p><p>A few things to note:</p><ul><li>You can pass as many <code>--announce</code> addresses as you want, but only one <code>--listen</code> address.</li><li>You don&#x27;t have to use TLS, but if you don&#x27;t, browsers running embedded Canvas apps won&#x27;t be able to talk to your peer.</li><li>If you&#x27;d prefer to announce on a public static IP instead of a DNS name, announce on <code>/ip4/{publicIP}/tcp/{port}/wss</code>.</li><li>If your DNS name only has <code>AAAA</code> records (???), use <code>/dns6</code> instead of <code>/dns4</code>.</li><li>You can pass a <code>--listen</code> address without an <code>--announce</code> address to delegate to libp2p&#x27;s autonat and identify services, which are works in progress. It&#x27;s best to provide a public address if you have one.</li></ul><p>Almost always, <code>--listen</code> will be of the form <code>/ip4/0.0.0.0/tcp/${port}/ws</code>, and <code>--announce</code> will be of the form <code>/dns4/${hostname}/tcp/{port}/wss</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="reference">Reference<a href="#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">canvas run &lt;app&gt;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Run an app, by path or IPFS hash</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Positionals:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  app  Path to app file, or IPFS hash of app                 [string] [required]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --version       Show version number                                  [boolean]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --help          Show help                                            [boolean]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --port          Port to bind the Core API             [number] [default: 8000]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --offline       Disable libp2p                      [boolean] [default: false]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --disable-ping  Disable peer health check pings     [boolean] [default: false]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --install       Install a local app and run it in production mode</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                                      [boolean] [default: false]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --listen        Internal libp2p /ws multiaddr, e.g. /ip4/0.0.0.0/tcp/4444/ws</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                                                         [array]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --announce      Public libp2p /ws multiaddr, e.g. /dns4/myapp.com/tcp/4444/ws</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                                                         [array]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --reset         Reset the message log and model databases</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                                      [boolean] [default: false]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --replay        Reconstruct the model database by replying the message log</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                                      [boolean] [default: false]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --unchecked     Run the node in unchecked mode, without verifying block hashes</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                                                       [boolean]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --metrics       Expose Prometheus endpoint at /metrics</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                                      [boolean] [default: false]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --p2p           Expose internal libp2p debugging endpoints</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                                      [boolean] [default: false]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --verbose       Enable verbose logging              [boolean] [default: false]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --chain         Declare chain implementations and provide RPC endpoints for re</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  ading on-chain data (format: {chain} or {chain}={URL}) [array]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --static        Serve a static directory from /, and API routes from /api</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                                                        [string]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http-api">HTTP API<a href="#http-api" class="hash-link" aria-label="Direct link to HTTP API" title="Direct link to HTTP API">​</a></h2><p>Running a Canvas app with <code>canvas run</code> will serve an HTTP API on <code>http://127.0.0.1:8000</code> by default. You can change the port with the <code>--port</code> option.</p><p>The basic routes are:</p><ul><li><code>POST /</code> - Apply an action or session. The request body must be the action or session as JSON.</li><li><code>GET /</code> - Get application status and metadata. Returns an <code>ApplicationData</code> JSON object.</li><li><code>GET /some/route/path?param1=value1&amp;param2=value2</code> - Evaluate a route. Returns a JSON array of SQL results. If the route has path components (declared by the spec with Express-style <code>/.../:name/...</code> names), the values of these params are bound to the query as strings. Additional params can be given in the query string as JSON values.</li></ul><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">type</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">ApplicationData</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  cid</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  uri</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  peerId</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  actions</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  routes</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  chains</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  peers</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> id</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> protocols</span><span class="token operator" style="color:#66d9ef">?</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> addresses</span><span class="token operator" style="color:#66d9ef">?</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  merkleRoots</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> Record</span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="exposing-optional-endpoints">Exposing optional endpoints<a href="#exposing-optional-endpoints" class="hash-link" aria-label="Direct link to Exposing optional endpoints" title="Direct link to Exposing optional endpoints">​</a></h3><p>Some optional API endpoints are disabled by default, since they should&#x27;t be exposed publicly.</p><ul><li><code>--metrics</code> - serve Prometheus metrics at <code>/metrics</code>.</li><li><code>--p2p</code> - expose internal libp2p endpoints under the <code>/p2p/</code> prefix.<ul><li><code>GET /p2p/connections</code> - returns a <code>{ peerId: string, address: string }[]</code> JSON array of the current peer connections.</li><li><code>POST /p2p/ping/:peerId</code> - attempt to ping a peer by PeerId, and respond with the latency in milliseconds if successful.</li></ul></li></ul><p>The metrics reported to Prometheus include default NodeJS metric, internal libp2p metrics, and some additional metrics specific to Canvas <code>Core</code>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="canvas_sync_time"><code>canvas_sync_time</code><a href="#canvas_sync_time" class="hash-link" aria-label="Direct link to canvas_sync_time" title="Direct link to canvas_sync_time">​</a></h4><p>A histogram of MST sync times.</p><table><thead><tr><th>label name</th><th>type</th><th>description</th></tr></thead><tbody><tr><td><code>uri</code></td><td><code>string</code></td><td>the source <code>ipfs://</code> URI</td></tr><tr><td><code>status</code></td><td><code>string</code></td><td>either <code>&quot;success&quot;</code> or <code>&quot;failure&quot;</code></td></tr></tbody></table><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="canvas_messages"><code>canvas_messages</code><a href="#canvas_messages" class="hash-link" aria-label="Direct link to canvas_messages" title="Direct link to canvas_messages">​</a></h4><p>A counter of messages applied</p><table><thead><tr><th>label name</th><th>type</th><th>description</th></tr></thead><tbody><tr><td><code>type</code></td><td><code>string</code></td><td>either <code>&quot;action&quot;</code> or <code>&quot;session&quot;</code></td></tr><tr><td><code>uri</code></td><td><code>string</code></td><td>the source <code>ipfs://</code> URI</td></tr></tbody></table><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="canvas_gossipsub_subscribers"><code>canvas_gossipsub_subscribers</code><a href="#canvas_gossipsub_subscribers" class="hash-link" aria-label="Direct link to canvas_gossipsub_subscribers" title="Direct link to canvas_gossipsub_subscribers">​</a></h4><p>A gauge counting GossipSub topic subscribers.</p><table><thead><tr><th>label name</th><th>type</th><th>description</th></tr></thead><tbody><tr><td><code>uri</code></td><td><code>string</code></td><td>the source <code>ipfs://</code> URI</td></tr></tbody></table><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="canvas_sync_peers"><code>canvas_sync_peers</code><a href="#canvas_sync_peers" class="hash-link" aria-label="Direct link to canvas_sync_peers" title="Direct link to canvas_sync_peers">​</a></h4><p>A gauge counting the observed active DHT application peers.</p><table><thead><tr><th>label name</th><th>type</th><th>description</th></tr></thead><tbody><tr><td><code>uri</code></td><td><code>string</code></td><td>the source <code>ipfs://</code> URI</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="subscribing-to-events-over-a-websocket-connection">Subscribing to events over a WebSocket connection<a href="#subscribing-to-events-over-a-websocket-connection" class="hash-link" aria-label="Direct link to Subscribing to events over a WebSocket connection" title="Direct link to Subscribing to events over a WebSocket connection">​</a></h3><p>The HTTP API also accepts WebSocket connections at the root path <code>/</code>. The WebSocket server will respond to messages with <code>message.data === &quot;ping&quot;</code> with <code>socket.send(&quot;pong&quot;)</code>. Otherwise, it is used to push application <em>events</em> to clients in real-time. Events are all of the form <code>{ type: string, detail: { ... } }</code>.</p><ul><li><code>{ type: &quot;update&quot;, detail: { uri: string; root: string | null } }</code> - emitted after apply a new batch of actions and committing the effects to the model database.</li><li><code>{ type: &quot;sync&quot;, detail: { uri: string; peer: string; time: number; status: &quot;success&quot; | &quot;failure&quot; } }</code> - emitted after intiating MST sync with another peer.</li><li><code>{ type: &quot;connect&quot;, detail: { peer: string } }</code> - emitted after opening a new libp2p connection to another peer. These are low-level transport-layer connections, not application-level logical streams. This means the peers aren&#x27;t necessarily running the same application, since all Canvas peers connect on the same mesh and share a DHT.</li><li><code>{ type: &quot;disconnect&quot;, detail: { peer: string } }</code> - emitted after closing a libp2p connection.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="serving-static-content-alonside-the-api">Serving static content alonside the API<a href="#serving-static-content-alonside-the-api" class="hash-link" aria-label="Direct link to Serving static content alonside the API" title="Direct link to Serving static content alonside the API">​</a></h3><p><code>--static [directory]</code> can be used to serve a static directory alongside the application API. This is the easiest way to bundle a frontend that uses Canvas as a backend. If the <code>--static</code> flag is provided, all of the HTTP API routes move under the <code>/api/</code> prefix, and the root path <code>/</code> serves the files in <code>[directory]</code>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/canvas/packages/hooks"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Canvas React Hooks</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/canvas/packages/core"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">@canvas-js/core</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a></li><li><a href="#running-an-application" class="table-of-contents__link toc-highlight">Running an application</a><ul><li><a href="#installing-contracts" class="table-of-contents__link toc-highlight">Installing contracts</a></li><li><a href="#providing-chain-rpcs-and-multi-chain-support" class="table-of-contents__link toc-highlight">Providing chain RPCs and multi-chain support</a></li><li><a href="#joining-the-libp2p-mesh" class="table-of-contents__link toc-highlight">Joining the libp2p mesh</a></li><li><a href="#reference" class="table-of-contents__link toc-highlight">Reference</a></li></ul></li><li><a href="#http-api" class="table-of-contents__link toc-highlight">HTTP API</a><ul><li><a href="#exposing-optional-endpoints" class="table-of-contents__link toc-highlight">Exposing optional endpoints</a></li><li><a href="#subscribing-to-events-over-a-websocket-connection" class="table-of-contents__link toc-highlight">Subscribing to events over a WebSocket connection</a></li><li><a href="#serving-static-content-alonside-the-api" class="table-of-contents__link toc-highlight">Serving static content alonside the API</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Canvas Technologies, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.7e87f4e2.js"></script>
<script src="/assets/js/main.42f05762.js"></script>
</body>
</html>